# Web安全事件管理系统 - 前后端设计大纲

## 📋 目录
- [1. 项目概述](#1-项目概述)
- [2. 整体架构设计](#2-整体架构设计)
- [3. 后端架构设计](#3-后端架构设计)
- [4. 前端架构设计](#4-前端架构设计)
- [5. 数据库设计](#5-数据库设计)
- [6. 接口设计](#6-接口设计)
- [7. 技术选型](#7-技术选型)
- [8. 开发计划](#8-开发计划)

---

## 1. 项目概述

### 1.1 项目简介
**大模型辅助的Web应用安全事件管理系统**是一个集成了AI智能分析的现代化安全监控平台，旨在为中小企业提供全面的Web安全监控和事件管理解决方案。

### 1.2 核心功能
- 🔍 **实时监控**: 7×24小时Web安全事件监控
- 🛡️ **威胁检测**: SQL注入、XSS、命令注入等多种攻击检测
- 🤖 **AI分析**: 基于大语言模型的智能威胁分析
- 📊 **统计分析**: 多维度安全事件统计和趋势分析
- 📋 **事件管理**: 完整的安全事件生命周期管理
- 📄 **报告生成**: 自动化安全报告和建议生成

### 1.3 技术特点
- **异步架构**: 基于Python asyncio的高并发处理
- **AI驱动**: LLM智能分析，提供人性化的威胁解读
- **实时监控**: 支持实时日志流分析和告警
- **可扩展**: 模块化设计，易于扩展新的检测能力
- **用户友好**: 现代化的Web界面，直观的数据展示

---

## 2. 整体架构设计

### 2.1 系统架构图
```
┌─────────────────────────────────────────────────────────────────┐
│                        Web安全事件管理系统                        │
├─────────────────────────────────────────────────────────────────┤
│  前端层 (Frontend)                                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  监控大屏    │  │  事件管理    │  │  统计分析    │  │  系统配置    │ │
│  │  Dashboard  │  │  Events     │  │  Analytics  │  │  Settings   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  API网关层 (API Gateway)                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  认证鉴权    │  │  接口路由    │  │  限流控制    │  │  日志记录    │ │
│  │  Auth       │  │  Router     │  │  Rate Limit │  │  Logging    │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  业务逻辑层 (Business Logic)                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  事件检测    │  │  AI分析     │  │  统计计算    │  │  告警处理    │ │
│  │  Detection  │  │  LLM        │  │  Statistics │  │  Alerting   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  数据采集层 (Data Collection)                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  日志采集    │  │  流量监听    │  │  API接入    │  │  文件监控    │ │
│  │  Log Capture│  │  Traffic    │  │  API Source │  │  File Watch │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  数据存储层 (Data Storage)                                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  事件数据库  │  │  统计缓存    │  │  配置存储    │  │  用户数据    │ │
│  │  MySQL      │  │  Redis      │  │  Config DB  │  │  User DB    │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈选择
**后端技术栈**:
- Python 3.11 + FastAPI (异步Web框架)
- SQLAlchemy (ORM框架)
- Redis (缓存和消息队列)
- MySQL (关系型数据库)
- OpenAI API (大语言模型)
- aiofiles (异步文件操作)

**前端技术栈**:
- Vue 3 + TypeScript (现代化前端框架)
- Element Plus (UI组件库)
- ECharts (数据可视化)
- Pinia (状态管理)
- Vue Router (路由管理)
- Axios (HTTP客户端)

---

## 3. 后端架构设计

### 3.1 模块结构设计
```
backend/
├── app/
│   ├── api/                    # API接口层
│   │   ├── __init__.py
│   │   ├── events.py          # 事件管理接口
│   │   ├── statistics.py      # 统计分析接口
│   │   ├── auth.py            # 认证授权接口
│   │   └── dashboard.py       # 仪表板接口
│   ├── capture/               # 数据采集模块
│   │   ├── __init__.py
│   │   ├── base.py           # 采集器基类
│   │   ├── log_capturer.py   # 日志文件采集器
│   │   └── stream_capturer.py # 实时流采集器
│   ├── detector/              # 检测引擎模块
│   │   ├── __init__.py
│   │   ├── base.py           # 检测器基类
│   │   ├── detection_engine.py # 检测引擎核心
│   │   ├── sql_injection_detector.py # SQL注入检测
│   │   ├── xss_detector.py   # XSS攻击检测
│   │   └── command_injection_detector.py # 命令注入检测
│   ├── llm/                   # AI分析模块
│   │   ├── __init__.py
│   │   ├── base.py           # LLM提供者基类
│   │   ├── openai_provider.py # OpenAI集成
│   │   └── analysis_service.py # 分析服务
│   ├── storage/               # 存储模块
│   │   ├── __init__.py
│   │   ├── base.py           # 存储基类
│   │   ├── mysql_storage.py  # MySQL存储
│   │   └── redis_storage.py  # Redis存储
│   ├── core/                  # 核心模块
│   │   ├── __init__.py
│   │   ├── models.py         # 数据模型
│   │   ├── exceptions.py     # 异常定义
│   │   └── security.py       # 安全工具
│   ├── config/                # 配置模块
│   │   ├── __init__.py
│   │   └── settings.py       # 配置管理
│   └── services/              # 业务服务层
│       ├── __init__.py
│       ├── event_service.py  # 事件服务
│       ├── statistics_service.py # 统计服务
│       └── alert_service.py  # 告警服务
├── tests/                     # 测试模块
├── requirements.txt           # 依赖管理
├── main.py                   # 应用入口
└── Dockerfile               # 容器化配置
```

### 3.2 核心业务流程
**事件处理流程**:
1. **数据采集**: 从日志文件、网络流量等源采集HTTP请求
2. **威胁检测**: 通过多种检测器识别安全威胁
3. **AI分析**: 调用LLM对可疑事件进行深度分析
4. **事件存储**: 将检测结果存储到数据库
5. **实时统计**: 更新统计数据和告警规则
6. **通知告警**: 根据威胁级别发送告警通知

---

## 4. 前端架构设计

### 4.1 前端目录结构
```
frontend/
├── src/
│   ├── components/           # 公共组件
│   │   ├── layout/          # 布局组件
│   │   │   ├── AppHeader.vue
│   │   │   ├── AppSidebar.vue
│   │   │   └── AppMain.vue
│   │   ├── charts/          # 图表组件
│   │   │   ├── LineChart.vue
│   │   │   ├── PieChart.vue
│   │   │   └── BarChart.vue
│   │   └── common/          # 通用组件
│   │       ├── SearchBox.vue
│   │       ├── DataTable.vue
│   │       └── StatusTag.vue
│   ├── views/               # 页面组件
│   │   ├── Dashboard/       # 监控大屏
│   │   │   ├── index.vue
│   │   │   ├── RealTimeMonitor.vue
│   │   │   └── ThreatOverview.vue
│   │   ├── Events/          # 事件管理
│   │   │   ├── index.vue
│   │   │   ├── EventList.vue
│   │   │   └── EventDetail.vue
│   │   ├── Analytics/       # 统计分析
│   │   │   ├── index.vue
│   │   │   ├── TrendAnalysis.vue
│   │   │   └── ThreatStatistics.vue
│   │   └── Settings/        # 系统设置
│   │       ├── index.vue
│   │       ├── DetectionRules.vue
│   │       └── AlertConfig.vue
│   ├── stores/              # 状态管理
│   │   ├── auth.ts          # 认证状态
│   │   ├── events.ts        # 事件状态
│   │   ├── statistics.ts    # 统计状态
│   │   └── settings.ts      # 设置状态
│   ├── services/            # API服务
│   │   ├── api.ts           # API基础配置
│   │   ├── events.ts        # 事件API
│   │   ├── statistics.ts    # 统计API
│   │   └── auth.ts          # 认证API
│   ├── router/              # 路由配置
│   │   └── index.ts
│   ├── styles/              # 样式文件
│   │   ├── global.scss
│   │   └── variables.scss
│   └── utils/               # 工具函数
│       ├── dateUtils.ts
│       ├── formatters.ts
│       └── validators.ts
├── public/                  # 静态资源
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### 4.2 核心页面设计

#### 4.2.1 监控大屏 (Dashboard)
**功能需求**:
- 实时威胁监控面板
- 关键指标展示 (今日攻击次数、威胁类型分布)
- 实时事件流显示
- 系统状态监控

**设计思路**:
- 采用卡片式布局，重要指标一目了然
- 左右分栏设计，左侧实时监控，右侧威胁概览
- 响应式设计，适配不同屏幕尺寸
- 实时数据更新，WebSocket推送最新事件

#### 4.2.2 事件管理 (Events)
**功能需求**:
- 安全事件列表展示
- 事件筛选和搜索
- 事件详情查看
- 事件状态管理

**设计思路**:
- 顶部搜索筛选区域，支持多条件组合查询
- 表格展示事件列表，支持分页和排序
- 事件状态可视化，不同威胁等级用不同颜色标识
- 事件详情弹窗，展示完整的请求信息和AI分析结果

#### 4.2.3 统计分析 (Analytics)
**功能需求**:
- 威胁趋势分析图表
- 攻击类型分布统计
- IP地理位置分析
- 时段分析报告

**设计思路**:
- 时间维度选择器，支持预设时间段和自定义范围
- 多图表并排展示，趋势分析和统计分布对比
- AI生成的分析报告，提供专业的威胁评估
- 交互式图表，支持数据钻取和详细查看

---

## 5. 数据库设计

### 5.1 核心数据表设计

#### 5.1.1 安全事件表 (security_events)
```sql
CREATE TABLE security_events (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_id VARCHAR(36) UNIQUE NOT NULL,          -- 事件唯一标识
    source_ip VARCHAR(45) NOT NULL,                -- 来源IP
    target_url TEXT NOT NULL,                      -- 目标URL
    http_method VARCHAR(10) NOT NULL,              -- HTTP方法
    user_agent TEXT,                               -- 用户代理
    threat_type VARCHAR(50) NOT NULL,              -- 威胁类型
    severity_level ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',
    detection_time DATETIME NOT NULL,              -- 检测时间
    raw_request TEXT,                              -- 原始请求
    attack_payload TEXT,                           -- 攻击载荷
    ai_analysis TEXT,                              -- AI分析结果
    status ENUM('pending', 'confirmed', 'false_positive', 'resolved') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_source_ip (source_ip),
    INDEX idx_threat_type (threat_type),
    INDEX idx_detection_time (detection_time),
    INDEX idx_status (status)
);
```

#### 5.1.2 威胁统计表 (threat_statistics)
```sql
CREATE TABLE threat_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    stat_date DATE NOT NULL,                       -- 统计日期
    stat_hour TINYINT DEFAULT NULL,                -- 统计小时 (0-23)
    threat_type VARCHAR(50) NOT NULL,              -- 威胁类型
    attack_count INT DEFAULT 0,                    -- 攻击次数
    unique_ips INT DEFAULT 0,                      -- 唯一IP数
    blocked_count INT DEFAULT 0,                   -- 拦截次数
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_stat_date_hour_type (stat_date, stat_hour, threat_type),
    INDEX idx_stat_date (stat_date),
    INDEX idx_threat_type (threat_type)
);
```

#### 5.1.3 IP黑名单表 (ip_blacklist)
```sql
CREATE TABLE ip_blacklist (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    ip_address VARCHAR(45) NOT NULL,               -- IP地址
    reason TEXT,                                   -- 拉黑原因
    threat_count INT DEFAULT 0,                    -- 威胁次数
    first_seen DATETIME NOT NULL,                  -- 首次发现时间
    last_seen DATETIME NOT NULL,                   -- 最后发现时间
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_ip_address (ip_address),
    INDEX idx_status (status)
);
```

### 5.2 Redis缓存设计
**设计理念**:
- **实时统计缓存**: 今日攻击数、IP统计等热点数据
- **频率限制**: IP访问频率控制，防止暴力攻击
- **数据缓存**: 仪表板数据、威胁统计等计算结果缓存
- **消息队列**: AI分析任务队列，实现异步处理
- **事件流**: 实时安全事件流，支持WebSocket推送

---

## 6. 接口设计

### 6.1 RESTful API设计

#### 6.1.1 事件管理接口
**设计理念**:
- RESTful风格的API设计，语义化的URL路径
- 支持分页查询和多条件筛选
- 统一的响应格式和错误处理
- 批量操作支持，提高操作效率

#### 6.1.2 统计分析接口
**设计理念**:
- 多维度的统计数据接口，支持灵活的时间粒度
- 缓存机制优化，减少数据库查询压力
- 支持实时和历史数据查询
- 数据聚合和计算在后端完成

#### 6.1.3 实时监控接口
**设计理念**:
- WebSocket实现真正的实时通信
- 推送机制减少客户端轮询
- 系统健康状态监控，保证服务可用性
- 支持多客户端同时连接

### 6.2 响应数据格式
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 具体数据
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

---

## 7. 技术选型

### 7.1 后端技术选型理由

#### 7.1.1 FastAPI
**选择理由**:
- ✅ **高性能**: 基于Starlette和Pydantic，性能优异
- ✅ **异步支持**: 原生支持async/await，适合高并发场景
- ✅ **自动文档**: 自动生成OpenAPI文档
- ✅ **类型检查**: 内置数据验证和类型检查
- ✅ **现代化**: 支持最新的Python特性

#### 7.1.2 SQLAlchemy + MySQL
**选择理由**:
- ✅ **ORM功能**: 提供丰富的对象关系映射功能
- ✅ **数据库兼容**: 支持多种数据库，便于迁移
- ✅ **事务支持**: 完整的事务管理机制
- ✅ **查询优化**: 支持复杂查询和优化
- ✅ **成熟稳定**: 企业级应用的可靠选择

#### 7.1.3 Redis
**选择理由**:
- ✅ **高性能**: 内存存储，读写速度快
- ✅ **数据结构**: 支持多种数据结构，适合统计场景
- ✅ **持久化**: 支持数据持久化，保证数据安全
- ✅ **分布式**: 支持集群部署，易于扩展

### 7.2 前端技术选型理由

#### 7.2.1 Vue 3 + TypeScript
**选择理由**:
- ✅ **现代化**: 组合式API，更好的代码组织
- ✅ **性能优化**: 更小的包体积，更快的渲染
- ✅ **类型安全**: TypeScript提供类型检查
- ✅ **生态完善**: 丰富的第三方库和工具链
- ✅ **开发体验**: 优秀的开发工具和调试体验

#### 7.2.2 Element Plus
**选择理由**:
- ✅ **组件丰富**: 提供完整的UI组件库
- ✅ **设计一致**: 统一的设计语言和交互规范
- ✅ **Vue 3支持**: 原生支持Vue 3
- ✅ **国际化**: 支持多语言
- ✅ **文档完善**: 详细的使用文档和示例

#### 7.2.3 ECharts
**选择理由**:
- ✅ **功能强大**: 支持丰富的图表类型
- ✅ **性能优异**: 支持大数据量渲染
- ✅ **交互友好**: 丰富的交互功能
- ✅ **定制性强**: 高度可定制的样式和配置
- ✅ **生态完善**: 丰富的插件和扩展

---

## 8. 开发计划

### 8.1 项目里程碑

#### 阶段一：基础架构搭建 (2周)
**后端开发**:
- [ ] 项目基础架构搭建
- [ ] 数据库设计和初始化
- [ ] 核心数据模型定义
- [ ] API框架搭建

**前端开发**:
- [ ] 前端项目初始化
- [ ] 基础组件开发
- [ ] 路由和状态管理配置
- [ ] API接口封装

#### 阶段二：核心功能开发 (4周)
**后端开发**:
- [ ] 完善检测引擎模块
- [ ] 实现AI分析服务
- [ ] 开发事件管理API
- [ ] 完成统计分析API

**前端开发**:
- [ ] 监控大屏页面开发
- [ ] 事件管理页面开发
- [ ] 统计分析页面开发
- [ ] 实时数据展示功能

#### 阶段三：功能完善 (3周)
**后端开发**:
- [ ] 实时监控WebSocket接口
- [ ] 告警系统实现
- [ ] 用户认证和权限管理
- [ ] 性能优化和缓存策略

**前端开发**:
- [ ] 系统配置页面开发
- [ ] 用户管理界面
- [ ] 响应式设计优化
- [ ] 用户体验优化

#### 阶段四：测试和部署 (2周)
**测试**:
- [ ] 单元测试完善
- [ ] 集成测试
- [ ] 性能测试
- [ ] 安全测试

**部署**:
- [ ] Docker容器化
- [ ] 部署脚本编写
- [ ] 监控和日志配置
- [ ] 文档编写

### 8.2 技术风险评估

#### 8.2.1 主要技术风险
1. **AI API调用成本**: OpenAI API调用费用可能较高
   - **解决方案**: 实现请求缓存、结果复用、调用限制
   
2. **实时性能挑战**: 大量并发请求可能影响性能
   - **解决方案**: 异步处理、消息队列、负载均衡
   
3. **误报率控制**: 检测规则可能产生误报
   - **解决方案**: 规则优化、AI辅助验证、白名单机制

#### 8.2.2 技术难点
1. **流式数据处理**: 实时日志分析的技术实现
2. **大数据量查询**: 海量事件数据的高效查询
3. **实时通信**: WebSocket连接管理和消息推送
4. **缓存策略**: 复杂统计数据的缓存设计

### 8.3 人员配置建议
- **后端开发**: 2-3人，负责API开发、数据库设计、AI集成
- **前端开发**: 1-2人，负责UI/UX设计、组件开发、数据可视化
- **测试**: 1人，负责测试用例编写、自动化测试
- **产品/设计**: 1人，负责产品需求、UI设计、用户体验

---

## 9. 总结

本设计大纲为Web安全事件管理系统提供了完整的技术架构和实施方案。通过合理的技术选型和模块化设计，系统具备了：

1. **高可用性**: 异步架构保证系统高并发处理能力
2. **可扩展性**: 模块化设计便于功能扩展和维护
3. **智能化**: AI驱动的威胁分析提供智能化安全管理
4. **用户友好**: 现代化的Web界面提供优秀的用户体验
5. **企业级**: 完整的功能体系满足企业安全监控需求

该系统不仅是一个优秀的实训项目，更具备产品化和商业化的潜力，可以为中小企业提供专业的Web安全监控解决方案。

---

*文档版本: v1.0*  
*编写日期: 2024年*  
*项目团队: Web安全管理系统开发团队* 