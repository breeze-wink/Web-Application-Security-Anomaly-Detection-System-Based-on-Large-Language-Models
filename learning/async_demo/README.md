# Pythonå¼‚æ­¥ç¼–ç¨‹Demo

è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„Pythonå¼‚æ­¥ç¼–ç¨‹å­¦ä¹ ç¤ºä¾‹ï¼Œé€šè¿‡å®é™…ä»£ç æ¼”ç¤ºå¸®åŠ©ä½ ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚

## ğŸ“‹ ç›®å½•ç»“æ„

```
async_demo/
â”œâ”€â”€ basic_async.py          # åŸºç¡€å¼‚æ­¥ç¼–ç¨‹æ¦‚å¿µ
â”œâ”€â”€ async_generators.py     # å¼‚æ­¥ç”Ÿæˆå™¨ç¤ºä¾‹
â”œâ”€â”€ file_operations.py      # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ concurrent_tasks.py     # å¹¶å‘ä»»åŠ¡æ§åˆ¶
â”œâ”€â”€ requirements.txt        # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md              # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. è¿è¡Œç¤ºä¾‹

æ¯ä¸ªPythonæ–‡ä»¶éƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼š

```bash
# åŸºç¡€å¼‚æ­¥æ¦‚å¿µ
python basic_async.py

# å¼‚æ­¥ç”Ÿæˆå™¨
python async_generators.py

# å¼‚æ­¥æ–‡ä»¶æ“ä½œ
python file_operations.py

# å¹¶å‘ä»»åŠ¡æ§åˆ¶
python concurrent_tasks.py
```

## ğŸ“š å­¦ä¹ å†…å®¹

### 1. basic_async.py - åŸºç¡€å¼‚æ­¥ç¼–ç¨‹

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- `async/await` è¯­æ³•åŸºç¡€
- åŒæ­¥ vs å¼‚æ­¥æ‰§è¡Œå¯¹æ¯”
- å¼‚æ­¥å‡½æ•°çš„å®šä¹‰å’Œè°ƒç”¨
- `asyncio.gather()` å¹¶å‘æ‰§è¡Œ
- å¼‚å¸¸å¤„ç†æœºåˆ¶

**ç¤ºä¾‹åŒ…æ‹¬ï¼š**
- åŒæ­¥å‡½æ•° vs å¼‚æ­¥å‡½æ•°çš„æ€§èƒ½å¯¹æ¯”
- ç½‘ç»œè¯·æ±‚æ¨¡æ‹Ÿ
- æ•°æ®åº“æŸ¥è¯¢æ¨¡æ‹Ÿ
- æ··åˆå¼‚æ­¥æ“ä½œ
- å¼‚æ­¥å¼‚å¸¸å¤„ç†

**å…³é”®å­¦ä¹ ç‚¹ï¼š**
```python
# å¼‚æ­¥å‡½æ•°å®šä¹‰
async def async_task(name: str, duration: int) -> str:
    await asyncio.sleep(duration)  # éé˜»å¡ç­‰å¾…
    return f"ä»»åŠ¡ {name} çš„ç»“æœ"

# å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡
results = await asyncio.gather(
    async_task("A", 2),
    async_task("B", 3),
    async_task("C", 1)
)
```

### 2. async_generators.py - å¼‚æ­¥ç”Ÿæˆå™¨

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- `AsyncGenerator` ç±»å‹æ³¨è§£
- `yield` åœ¨å¼‚æ­¥å‡½æ•°ä¸­çš„ä½¿ç”¨
- `async for` å¾ªç¯æ¶ˆè´¹å¼‚æ­¥ç”Ÿæˆå™¨
- å®æ—¶æ•°æ®æµå¤„ç†
- å¯æ§åˆ¶çš„å¼‚æ­¥ç”Ÿæˆå™¨

**ç¤ºä¾‹åŒ…æ‹¬ï¼š**
- åŸºç¡€å¼‚æ­¥ç”Ÿæˆå™¨
- æ•°æ®æµç›‘æ§ï¼ˆç±»ä¼¼ä½ çš„æ—¥å¿—æ•è·ï¼‰
- æ–‡ä»¶è¡Œè¯»å–ç”Ÿæˆå™¨
- ç½‘ç»œè¯·æ±‚æ‰¹å¤„ç†
- ç³»ç»Ÿç›‘æ§æ•°æ®ç”Ÿæˆ

**å…³é”®å­¦ä¹ ç‚¹ï¼š**
```python
# å¼‚æ­¥ç”Ÿæˆå™¨å®šä¹‰
async def data_stream() -> AsyncGenerator[dict, None]:
    for i in range(10):
        await asyncio.sleep(1)
        yield {"id": i, "data": f"æ•°æ®{i}"}

# æ¶ˆè´¹å¼‚æ­¥ç”Ÿæˆå™¨
async for data in data_stream():
    print(f"æ”¶åˆ°æ•°æ®: {data}")
```

### 3. file_operations.py - å¼‚æ­¥æ–‡ä»¶æ“ä½œ

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- `aiofiles` åº“çš„ä½¿ç”¨
- å¼‚æ­¥æ–‡ä»¶è¯»å†™
- æ–‡ä»¶æµå¼å¤„ç†
- æ–‡ä»¶ç›‘æ§ï¼ˆç±»ä¼¼ `tail -f`ï¼‰
- æ‰¹é‡æ–‡ä»¶å¤„ç†

**ç¤ºä¾‹åŒ…æ‹¬ï¼š**
- åŸºç¡€å¼‚æ­¥æ–‡ä»¶è¯»å†™
- æ—¥å¿—æ–‡ä»¶å®æ—¶ç›‘æ§ï¼ˆç±»ä¼¼ä½ çš„ log_capturerï¼‰
- æ‰¹é‡æ–‡ä»¶å¤„ç†
- å¤§æ–‡ä»¶æµå¼å¤„ç†
- æ–‡ä»¶å†…å®¹æœç´¢

**å…³é”®å­¦ä¹ ç‚¹ï¼š**
```python
# å¼‚æ­¥æ–‡ä»¶è¯»å–
async with aiofiles.open('file.txt', 'r') as f:
    content = await f.read()
    
# å¼‚æ­¥æ–‡ä»¶ç›‘æ§
async with aiofiles.open('log.txt', 'r') as f:
    await f.seek(0, 2)  # ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾
    while True:
        line = await f.readline()
        if line:
            process_log_line(line)
        else:
            await asyncio.sleep(0.1)
```

### 4. concurrent_tasks.py - å¹¶å‘ä»»åŠ¡æ§åˆ¶

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- ä»»åŠ¡åˆ›å»ºå’Œç®¡ç† (`asyncio.create_task`)
- å¹¶å‘æ§åˆ¶ (`asyncio.Semaphore`)
- ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ (`asyncio.Queue`)
- é”å’ŒåŒæ­¥ (`asyncio.Lock`)
- äº‹ä»¶å’Œæ¡ä»¶å˜é‡ (`asyncio.Event`)
- è¶…æ—¶æ§åˆ¶ (`asyncio.wait_for`)
- èµ„æºæ± ç®¡ç†

**ç¤ºä¾‹åŒ…æ‹¬ï¼š**
- åŸºç¡€å¹¶å‘æ§åˆ¶
- ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°
- é˜Ÿåˆ—å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…
- é”ä¿æŠ¤å…±äº«èµ„æº
- äº‹ä»¶åè°ƒå¤šä¸ªåç¨‹
- è¶…æ—¶å¤„ç†æœºåˆ¶
- ç½‘é¡µçˆ¬è™«æ¨¡æ‹Ÿ
- èµ„æºæ± ç®¡ç†

**å…³é”®å­¦ä¹ ç‚¹ï¼š**
```python
# ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°
semaphore = asyncio.Semaphore(3)  # æœ€å¤š3ä¸ªå¹¶å‘

async def worker(worker_id):
    async with semaphore:
        # å·¥ä½œä»£ç 
        await do_work()

# ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼
queue = asyncio.Queue(maxsize=10)

async def producer():
    await queue.put(item)

async def consumer():
    item = await queue.get()
    queue.task_done()
```

## ğŸ¯ ä¸ä½ çš„é¡¹ç›®å…³è”

è¿™ä¸ªdemoç‰¹åˆ«å…³æ³¨äº†ä¸ä½ çš„ `log_capturer.py` ç›¸ä¼¼çš„æ¨¡å¼ï¼š

1. **æ–‡ä»¶ç›‘æ§æ¨¡å¼** - `file_operations.py` ä¸­çš„æ—¥å¿—ç›‘æ§ç¤ºä¾‹
2. **å¼‚æ­¥ç”Ÿæˆå™¨** - `async_generators.py` ä¸­çš„æµå¼æ•°æ®å¤„ç†
3. **å¹¶å‘æ§åˆ¶** - `concurrent_tasks.py` ä¸­çš„èµ„æºç®¡ç†

## ğŸ’¡ æ ¸å¿ƒå¼‚æ­¥ç¼–ç¨‹æ¦‚å¿µ

### 1. äº‹ä»¶å¾ªç¯ (Event Loop)
å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚

### 2. åç¨‹ (Coroutine)
ä½¿ç”¨ `async def` å®šä¹‰çš„å‡½æ•°ï¼Œå¯ä»¥è¢«æš‚åœå’Œæ¢å¤æ‰§è¡Œã€‚

### 3. ç­‰å¾…ç‚¹ (Await Point)
ä½¿ç”¨ `await` çš„åœ°æ–¹ï¼Œåç¨‹ä¼šåœ¨æ­¤å¤„æš‚åœï¼Œè®©å‡ºæ§åˆ¶æƒã€‚

### 4. å¹¶å‘ vs å¹¶è¡Œ
- **å¹¶å‘**: å¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œï¼ˆå•çº¿ç¨‹ï¼‰
- **å¹¶è¡Œ**: å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼ˆå¤šçº¿ç¨‹/å¤šè¿›ç¨‹ï¼‰

### 5. éé˜»å¡ I/O
å¼‚æ­¥æ“ä½œä¸ä¼šé˜»å¡æ•´ä¸ªç¨‹åºï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚

## ğŸ”§ æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹
- I/O å¯†é›†å‹ä»»åŠ¡ï¼ˆæ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œï¼‰
- éœ€è¦é«˜å¹¶å‘å¤„ç†çš„åœºæ™¯
- å®æ—¶æ•°æ®æµå¤„ç†

### 2. é¿å…å¸¸è§é™·é˜±
- ä¸è¦åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨é˜»å¡æ“ä½œï¼ˆå¦‚ `time.sleep`ï¼‰
- æ­£ç¡®å¤„ç†å¼‚æ­¥å¼‚å¸¸
- é¿å…å¿˜è®°ä½¿ç”¨ `await` å…³é”®å­—

### 3. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°é‡
- é€‚å½“ä½¿ç”¨è¶…æ—¶å¤„ç†
- åˆç†ç®¡ç†èµ„æºï¼ˆæ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰

## ğŸƒâ€â™‚ï¸ å®é™…åº”ç”¨åœºæ™¯

1. **Web çˆ¬è™«** - å¹¶å‘æŠ“å–å¤šä¸ªç½‘é¡µ
2. **API æœåŠ¡** - å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚
3. **æ•°æ®å¤„ç†** - å®æ—¶å¤„ç†æ•°æ®æµ
4. **æ–‡ä»¶ç›‘æ§** - ç›‘æ§æ—¥å¿—æ–‡ä»¶å˜åŒ–
5. **æ‰¹é‡æ“ä½œ** - å¹¶å‘å¤„ç†å¤§é‡æ–‡ä»¶æˆ–æ•°æ®

## ğŸ“– è¿›é˜¶å­¦ä¹ 

è¿è¡Œå®Œè¿™äº›ç¤ºä¾‹åï¼Œå»ºè®®æ·±å…¥å­¦ä¹ ï¼š

1. `asyncio` å®˜æ–¹æ–‡æ¡£
2. `aiohttp` ç”¨äºå¼‚æ­¥HTTPå®¢æˆ·ç«¯/æœåŠ¡å™¨
3. `asyncpg` ç”¨äºå¼‚æ­¥PostgreSQLæ“ä½œ
4. `aioredis` ç”¨äºå¼‚æ­¥Redisæ“ä½œ
5. FastAPI æ¡†æ¶ï¼ˆå¼‚æ­¥Webæ¡†æ¶ï¼‰

## ğŸ¤ ä¸ä½ çš„ä»£ç å¯¹æ¯”

ä½ çš„ `log_capturer.py` ä¸­çš„å…³é”®æ¨¡å¼ï¼š

```python
# ä½ çš„ä»£ç æ¨¡å¼
async def capture_stream(self) -> AsyncGenerator[HTTPRequest, None]:
    async with aiofiles.open(self.log_file_path, 'r') as f:
        while self.is_running:
            line = await f.readline()
            if line:
                request = self._parse_log_line(line.strip())
                if request:
                    yield request
            else:
                await asyncio.sleep(0.1)
```

å¯¹åº”çš„demoç¤ºä¾‹åœ¨ `file_operations.py` å’Œ `async_generators.py` ä¸­ã€‚

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªdemoï¼Œä½ å°†å­¦ä¼šï¼š
- å¼‚æ­¥ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•
- å¦‚ä½•ç¼–å†™é«˜æ•ˆçš„å¼‚æ­¥ä»£ç 
- å¹¶å‘æ§åˆ¶å’Œèµ„æºç®¡ç†
- å®é™…åº”ç”¨åœºæ™¯çš„æœ€ä½³å®è·µ

æ¯ä¸ªç¤ºä¾‹éƒ½åŒ…å«è¯¦ç»†æ³¨é‡Šï¼Œå¸®åŠ©ä½ ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„å·¥ä½œåŸç†å’Œåº”ç”¨æ–¹æ³•ã€‚ 